apiVersion: policy.open-cluster-management.io/v1
kind: PolicyGenerator
metadata:
  name: policy-opp
placementBindingDefaults:
  name: binding-policy-opp-hub
policyDefaults:
  categories:
    - CM Configuration Management
  controls: 
    - CM-2 Baseline Configuration
  namespace: policies
  policySets:
    - opp-hub
  remediationAction: enforce
  severity: medium
  standards:
    - NIST SP 800-53
policies:
# Hub Operators Policies - start
- name: hub-enf-operators-install
  categories:
    - SI System and Information Integrity
  controls:
    - SI-7 Software Firmware and Information Integrity
  dependencies:
    - name: cv-inf-check
  evaluationInterval:
    compliant: never
  manifests:
    - path: install/opp-hub.yaml
  policySets:
    - opp-hub
# Hub Operators Policies - end
# All Operators Policies - start
- name: all-enf-operators-install
  categories:
    - SI System and Information Integrity
  controls:
    - SI-7 Software Firmware and Information Integrity
  dependencies:
    - name: cv-inf-check
  evaluationInterval:
    compliant: never
  manifests:
    - path: install/opp-all.yaml
  policySets:
    - opp-hub
    - opp-clusters
# All Operators Policies - end
# Manual Subscription Policies - start
- name: sub-enf-approval-manual
  categories:
    - SI System and Information Integrity
  controls:
    - SI-7 Software Firmware and Information Integrity
  evaluationInterval:
    compliant: never
  manifests:
    - path: upgrade/sub-approval-manual.yaml
  policySets:
    - sub-approval-manual
# Manual Subscription Policies - end
# Automatic Subscription Policies - start
- name: sub-enf-approval-automatic
  categories:
    - SI System and Information Integrity
  complianceType: mustonlyhave
  controls:
    - SI-7 Software Firmware and Information Integrity
  manifests:
    - path: upgrade/sub-approval-automatic.yaml
  policySets:
    - sub-approval-automatic
# Automatic Subscription Policies - end
# cs-redhat operator update Policies - start
- name: cs-enf-redhat-operator-update
  categories:
    - SI System and Information Integrity
  complianceType: musthave
  controls:
    - SI-7 Software Firmware and Information Integrity
  dependencies:
    - name: cv-inf-check
  manifests:
    - path: upgrade/cs-redhat-operator-update.yaml
  policySets:
    - sub-approval-automatic
# cs-redhat operator update Policies - end
# Create Router Bundle Policies - start
- name: proxy-sync-hub
  categories:
    - SI System and Information Integrity
  controls:
    - SI-7 Software Firmware and Information Integrity
  manifests:
    - path: proxy/proxy-sync-hub.yaml
  evaluationInterval:
    compliant: 1m
    noncompliant: 1m
  policySets:
    - opp-hub
# Create Router Bundle Policies - end
# Proxy Router Bundle Policies - start
- name: proxy-sync
  categories:
    - SI System and Information Integrity
  controls:
    - SI-7 Software Firmware and Information Integrity
  manifests:
    - path: proxy/proxy-sync.yaml
  policySets:
    - opp-clusters
# Proxy Router Bundle Policies - end
# Remediation config Policies - start
- name: remediation-enf-config
  categories:
    - SI System and Information Integrity
  controls:
    - SI-7 Software Firmware and Information Integrity
  evaluationInterval:
    compliant: never
  manifests:
    - path: remediation/config.yaml
  policySets:
    - opp-hub
    - opp-clusters
# Remediation config Policies - end
# CV check Policies - start
- name: cv-inf-check
  categories:
    - SI System and Information Integrity
  complianceType: mustnothave
  consolidateManifests: false
  controls:
    - SI-7 Software Firmware and Information Integrity
  manifests:
    - path: check/cv-check.yaml
  policySets:
    - opp-hub
    - opp-clusters
  remediationAction: inform
# CV check Policies - end
# CSV check Policies - start
- name: csv-inf-check
  categories:
    - SI System and Information Integrity
  consolidateManifests: false
  controls:
    - SI-7 Software Firmware and Information Integrity
  manifests:
    - path: check/csv-check.yaml
  policySets:
    - opp-hub
    - opp-clusters
  remediationAction: inform
# CSV check Policies - end
# CSV update Policies - start
#- name: csv-inf-update
#  categories:
#    - SI System and Information Integrity
#  consolidateManifests: false
#  controls:
#    - SI-7 Software Firmware and Information Integrity
#  manifests:
#    - path: check/csv-update.yaml
#  policySets:
#    - opp-hub
#    - opp-clusters
#  remediationAction: inform
# CSV update Policies - end
# infra label Policies - start
- name: infra-label
  categories:
    - SI System and Information Integrity
  consolidateManifests: false
  controls:
    - SI-7 Software Firmware and Information Integrity
  evaluationInterval:
    compliant: never
  manifests:
    - path: node/infra-label.yaml
  policySets:
    - opp-hub
    - opp-clusters
  remediationAction: enforce
# infra label Policies - end
# infra toleration Policies - start
- name: infra-toleration
  categories:
    - SI System and Information Integrity
  controls:
    - SI-7 Software Firmware and Information Integrity
  evaluationInterval:
    compliant: never
  manifests:
    - path: node/infra-toleration.yaml
  policySets:
    - opp-hub
    - opp-clusters
  remediationAction: enforce
# infra toleration Policies - end
# signature cm Policies - start
- name: signature-cm
  categories:
    - SI System and Information Integrity
  controls:
    - SI-7 Software Firmware and Information Integrity
  manifests:
    - path: upgrade/signature-cm.yaml
  policySets:
    - opp-hub
    - opp-clusters
  remediationAction: enforce
# signature cm Policies - end
# marketplace jobs Policies - start
- name: marketplace-jobs
  categories:
    - SI System and Information Integrity
  controls:
    - SI-7 Software Firmware and Information Integrity
  evaluationInterval:
    compliant: 10m
    noncompliant: 10m
  manifests:
    - path: upgrade/marketplace-jobs.yaml
  policySets:
    - sub-approval-automatic
  remediationAction: enforce
# marketplace jobs Policies - end
policySets:
  - description: The OpenShift Platform Plus policy set applies several policies
      that will install the OpenShift Platform Plus products using best practices
      that allow them to work well together. This policy set is focused on 
      the components that install to the Advanced Cluster Management hub.
    name: opp-hub
    placement:
      placementPath: place/hub-placement.yaml
  - description: The OpenShift Platform Plus policy set applies several policies
      that install the OpenShift Platform Plus products using best practices
      that allow them to work well together. This policy set is focused on 
      the components that install to every managed cluster.
    name: opp-clusters
    placement:
      placementPath: place/clusters-placement.yaml
  - name: sub-approval-manual
    placement:
      placementPath: place/sub-approval-manual.yaml
  - name: sub-approval-automatic
    placement:
      placementPath: place/sub-approval-automatic.yaml
